version: '3.8'

services:
  web:
    build: .
    # Remova ou mantenha o ports se quiser acesso direto tambÃ©m
    ports:
      - "8090:8090"
    environment:
      - DEBUG=False
      - ALLOWED_HOSTS=*
      - SECRET_KEY=k2z9po4i#n+1p(^ny1el2c!om(^-l+_%&ob0azk0-ike*-)81e
    volumes:
      - ./:/app
      - estoque_static_volume:/app/static  # Nome consistente
    command: >
      sh -c "python manage.py migrate &&
             python manage.py collectstatic --noinput &&
             python create_superuser_env.py &&
             gunicorn --bind 0.0.0.0:8090 --workers 4 inventory.wsgi:application"
    restart: unless-stopped
    # --- LABELS DO TRAEFIK (ESSENCIAIS) ---
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.estoque.rule=Host(`estoque.guilhermearaujo.cloud`)"
      - "traefik.http.routers.estoque.entrypoints=websecure"
      - "traefik.http.routers.estoque.tls.certresolver=mytlschallenge"
      - "traefik.http.services.estoque.loadbalancer.server.port=8090"
    networks:
      - traefik_network

networks:
  traefik_network:
    external: true
    name: root_web  # CONFIRME o nome correto da rede

volumes:
  estoque_static_volume:  # Nome consistente
